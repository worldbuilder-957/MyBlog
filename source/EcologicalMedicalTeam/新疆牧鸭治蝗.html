---
layout: false
---
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>æ–°ç–†ç‰§é¸­æ²»è—</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: "Microsoft YaHei", sans-serif;
      background: #f9fbff;
      color: #2c3e50;
      padding: 15px;
    }
    .header {
      text-align: center;
      background: linear-gradient(135deg, #0d47a1, #1976d2);
      color: white;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.15);
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .panel {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }
    .control-panel {
      flex: 1;
      min-width: 280px;
    }
    .chart-panel {
      flex: 2;
      min-width: 500px;
    }
    h2 {
      margin-bottom: 16px;
      color: #0d47a1;
      font-size: 18px;
    }
    .slider-group {
      margin: 16px 0;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: bold;
      color: #1565c0;
    }
    input[type="range"] {
      width: 100%;
      height: 8px;
      cursor: pointer;
    }
    .value-tag {
      text-align: right;
      font-weight: bold;
      color: #d32f2f;
      margin-top: 4px;
    }
    canvas {
      width: 100% !important;
      height: 320px !important;
      margin-top: 10px;
    }
    .status {
      margin-top: 12px;
      padding: 8px;
      background: #e8f5e9;
      border-radius: 6px;
      font-size: 14px;
      text-align: center;
      color: #2e7d32;
    }
  </style>
</head>
<body>

<div class="header">
  <h1>æ–°ç–†ç‰§é¸­æ²»è—</h1>
</div>

<div class="container">
  <div class="panel control-panel">
    <h2>ğŸ”¬ è°ƒæ•´ç¾å®³ä¸å¹²é¢„å‚æ•°</h2>
    
    <div class="slider-group">
      <label for="initLocust">åˆå§‹è—è™«å¯†åº¦ï¼ˆåª/å…¬é¡·ï¼‰</label>
      <input type="range" id="initLocust" min="100" max="5000" step="100" value="500">
      <div class="value-tag" id="initLocust-val">500 åª</div>
    </div>

    <div class="slider-group">
      <label for="ducks">é¸­ç¾¤æ•°é‡ï¼ˆåªï¼‰</label>
      <input type="range" id="ducks" min="0" max="5000" step="100" value="2000">
      <div class="value-tag" id="ducks-val">2000 åª</div>
    </div>

    <div class="slider-group">
      <label for="days">æ”¾ç‰§æ—¶é—´ï¼ˆå¤©ï¼‰</label>
      <input type="range" id="days" min="0" max="30" step="1" value="15">
      <div class="value-tag" id="days-val">15 å¤©</div>
    </div>

    <div class="status" id="status">â–¶ å‡†å¤‡å°±ç»ª</div>
  </div>

  <div class="panel chart-panel">
    <h2>ğŸ“ˆ è—è™«ç§ç¾¤åŠ¨æ€ï¼ˆé€æ—¥æ¨¡æ‹Ÿï¼‰</h2>
    <canvas id="chart"></canvas>
  </div>
</div>

<script>
  let myChart = null;
  let simulationRunning = false;
  let debounceTimer = null; // âœ… ä¿®å¤ï¼šç§»è‡³å…¨å±€ä½œç”¨åŸŸ

  function initChart() {
    const ctx = document.getElementById('chart').getContext('2d');
    myChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [
          {
            label: 'æ— å¹²é¢„ï¼ˆè‡ªç„¶ç¹æ®–ï¼‰',
            data: [],
            borderColor: '#e53935',
            borderWidth: 2,
            tension: 0.2,
            pointRadius: 0
          },
          {
            label: 'ç‰§é¸­å¹²é¢„ï¼ˆç”Ÿæ€æ²»ç†ï¼‰',
            data: [],
            borderColor: '#2e7d32',
            borderWidth: 3,
            tension: 0.2,
            pointRadius: 0
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        animation: false,
        interaction: {
          mode: 'index',
          intersect: false
        },
        plugins: {
          tooltip: {
            enabled: true,
            callbacks: {
              title: (context) => `ç¬¬ ${context[0].label} å¤©`,
              label: (context) => `${context.dataset.label}: ${context.raw} åª`
            }
          }
        },
        scales: {
          x: { 
            title: { display: true, text: 'æ—¶é—´ï¼ˆå¤©ï¼‰' },
            ticks: { stepSize: 5 }
          },
          y: { 
            title: { display: true, text: 'è—è™«å¯†åº¦ï¼ˆåª/å…¬é¡·ï¼‰' },
            beginAtZero: true,
            max: 12000
          }
        }
      }
    });
  }

  function simulate(duckCount, grazingDays, L0, totalDays = 30) {
    const r = 0.25;
    const a = 0.002;
    const h = 0.005;

    const natural = [];
    const withDucks = [];
    let L_nat = L0;
    let L_duck = L0;

    for (let t = 0; t <= totalDays; t++) {
      if (t === 0) {
        natural.push(Math.round(L_nat));
        withDucks.push(Math.round(L_duck));
      } else {
        L_nat = Math.min(12000, L_nat * Math.exp(r));
        natural.push(Math.round(L_nat));

        if (duckCount > 0 && t <= grazingDays) {
          const predation = (a * duckCount * L_duck) / (1 + a * h * L_duck);
          const growth = r * L_duck;
          L_duck = L_duck + (growth - predation);
          L_duck = Math.max(10, Math.min(12000, L_duck)); // ç¡®ä¿ â‰¥10
        } else {
          L_duck = Math.min(12000, L_duck * Math.exp(r));
        }
        withDucks.push(Math.round(L_duck));
      }
    }

    return {
      days: Array.from({length: totalDays + 1}, (_, i) => i),
      natural,
      withDucks
    };
  }

  async function runSimulation(L0, duckCount, grazingDays) {
    if (simulationRunning) return;
    simulationRunning = true;

    const statusEl = document.getElementById('status');
    statusEl.textContent = `â–¶ æ¨¡æ‹Ÿä¸­...`;

    const full = simulate(duckCount, grazingDays, L0);

    myChart.data.labels = [];
    myChart.data.datasets[0].data = [];
    myChart.data.datasets[1].data = [];
    myChart.update();

    for (let i = 0; i <= 30; i++) {
      if (!simulationRunning) break;
      myChart.data.labels.push(full.days[i]);
      myChart.data.datasets[0].data.push(full.natural[i]);
      myChart.data.datasets[1].data.push(full.withDucks[i]);
      myChart.update();
      await new Promise(r => setTimeout(r, 60));
    }

    const final = full.withDucks[30];
    let msg = `âœ… æœ€ç»ˆè—è™«ï¼š${final} åª`;
    if (final <= 200) msg += "ï¼ˆä¼˜ç§€æ§åˆ¶ï¼‰";
    else if (final <= 1000) msg += "ï¼ˆæœ‰æ•ˆæ§åˆ¶ï¼‰";
    else if (final <= 5000) msg += "ï¼ˆéƒ¨åˆ†æ§åˆ¶ï¼‰";
    else msg += "ï¼ˆæ§åˆ¶å¤±è´¥ï¼‰";
    statusEl.textContent = msg;

    simulationRunning = false;
  }

  function stopSimulation() {
    simulationRunning = false;
  }

  window.addEventListener('DOMContentLoaded', () => {
    initChart();

    const sliders = {
      initLocust: { el: document.getElementById('initLocust'), suffix: ' åª' },
      ducks: { el: document.getElementById('ducks'), suffix: ' åª' },
      days: { el: document.getElementById('days'), suffix: ' å¤©' }
    };

    Object.values(sliders).forEach(s => {
      const valEl = document.getElementById(s.el.id + '-val');
      const update = () => {
        valEl.textContent = s.el.value + s.suffix;
        triggerSimulation();
      };
      s.el.addEventListener('input', update);
      update(); // init
    });

    // âœ… ä¿®å¤ï¼šå°†å‡½æ•°å®šä¹‰ç§»åˆ°å˜é‡å£°æ˜ä¹‹å
    function triggerSimulation() {
      stopSimulation();
      if (debounceTimer) clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => {
        const L0 = parseInt(sliders.initLocust.el.value);
        const D = parseInt(sliders.ducks.el.value);
        const T = parseInt(sliders.days.el.value);
        runSimulation(L0, D, T);
      }, 100);
    }
  });
</script>

</body>
</html>